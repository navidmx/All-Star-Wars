var express=require("express"),app=express(),server=require("http").Server(app),io=require("socket.io")(server),shortid=require("shortid"),Bitly=require("bitly");app.set("view engine","ejs"),app.use(express["static"]("public")),app.use(express["static"]("views")),app.set("views",__dirname+"/views");var rooms=[],bitly=new Bitly("e7d67277347e7c7b79b591cafa422a22e9a380fb");app.get("/",function(e,t){var n=shortid.generate();bitly.shorten("https://"+e.headers.host+"/lightsaber/"+n).then(function(e){t.render("viewer",{room:n,roomURL:e.data.url})},function(e){throw e}),rooms.push(n)}),app.get("/lightsaber/:roomId",function(e,t){t.render("lightsaber",{room:e.params.roomId})});var port=process.env.PORT||3e3;server.listen(port,function(e,t){console.log("Listening on "+port)}),io.on("connection",function(e){e.on("viewerjoin",function(t){e.room=t.room,e.join(e.room),console.log("Viewer joined: "+e.room)}),e.on("lightsaberjoin",function(t){e.room=t.room,e.join(e.room),io.sockets["in"](e.room).emit("beginsetup"),console.log("Lightsaber joined: "+e.room)}),e.on("setupcomplete",function(t){e.broadcast.to(e.room).emit("setupcomplete"),console.log("Lightsaber setup complete: "+e.room)}),e.on("viewready",function(t){e.broadcast.to(e.room).emit("viewready"),console.log("View ready: "+e.room)}),e.on("startedGame",function(t){e.broadcast.to(e.room).emit("beginGame",t)}),e.on("sendorientation",function(t){e.broadcast.to(e.room).emit("updateorientation",t)}),e.on("sendhit",function(t){e.broadcast.to(e.room).emit("playsound",t)}),e.on("powerAttack_1",function(t){e.broadcast.to(e.room).emit("init_powerAttack_1",t)})});
