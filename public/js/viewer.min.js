function init(){started=!1,width=window.innerWidth,height=window.innerHeight,scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(90,width/height,.001,2e4),renderer=new THREE.WebGLRenderer,stereo=new THREE.StereoEffect(renderer),clock=new THREE.Clock,textureLoader=new THREE.TextureLoader,renderer.setSize(window.innerWidth,window.innerHeight),camera.lookAt(0,0,0),camera.position.set(0,15,0),scene.add(camera),container=document.getElementById("container"),domElement=renderer.domElement,orbitControls=new THREE.OrbitControls(camera,domElement),orbitControls.target.set(camera.position.x+.15,camera.position.y,camera.position.z),orbitControls.noPan=!0,orbitControls.noZoom=!0,isMobile&&(controls=new DeviceOrientationController(camera,renderer.domElement),controls.connect()),$(".landing").hide(),$(".confirm-button").hide(),container.appendChild(domElement),domElement.addEventListener("click",fullscreen,!1),setupScene()}function setupScene(){lasers=[];var e=new Sky(textureLoader);console.log(e),scene.add(e),floQWor=new Floor(textureLoader,renderer),scene.add(floor),corridor=new Corridor(textureLoader),scene.add(corridor),hand=new Hand(camera),lightsaber=new Lightsaber,hand.add(lightsaber),Utils.collidableMeshList.push(lightsaber),lightAngle=new THREE.PointLight(10066329,1,500),lightAngle.position.set(0,50,0),scene.add(lightAngle);new THREE.AxisHelper(200);requestAnimationFrame(animate)}function setupGame(){scene.add(hand),laser=new Laser,window.addEventListener("deviceorientation",setOrientationControls,!0),window.setInterval(function(){var e=laser.clone();e.position.set(200,Utils.getRandomInRange(5,20),Utils.getRandomInRange(-10,10)),e.name="laser",e.velocity=new THREE.Vector3(-1,0,0),lasers.push(e),Utils.collidableMeshList.push(e),scene.add(e)},1500)}function fullscreen(){container.requestFullscreen?container.requestFullscreen():container.msRequestFullscreen?container.msRequestFullscreen():container.mozRequestFullScreen?container.mozRequestFullScreen():container.webkitRequestFullscreen&&container.webkitRequestFullscreen()}function setOrientationControls(e){e.alpha&&(controls=new THREE.DeviceOrientationControls(camera,!0),controls.connect(),controls.update(),window.removeEventListener("deviceorientation",setOrientationControls,!0))}function setObjectQuat(e,t){var i,a,s,n=t.g?t.g*(Math.PI/180):0,r=t.b?t.b*(Math.PI/180):0,o=t.a?t.a*(Math.PI/180):0,l=new THREE.Euler;a=r,s=n,i=o,l.set(0,-s,a-Math.PI/2),e.quaternion.setFromEuler(l)}function resize(){var e=window.innerWidth,t=window.innerHeight;camera.aspect=e/t,camera.updateProjectionMatrix(),renderer.setSize(e,t),stereo.setSize(e,t)}function animate(){clock.getElapsedTime();requestAnimationFrame(animate),update(clock.getDelta()),isMobile?stereo.render(scene,camera):renderer.render(scene,camera)}function update(e){resize(),camera.updateProjectionMatrix(),orbitControls.update(e);var t=Utils.cameraLookDir(camera);Math.abs(1-t.x)<.01&&!started&&(setupGame(),started=!0),Utils.checkCollision(lightsaber.children[0],"laser",!0,function(e){e&&(socket.emit("sendhit"),e.velocity=new THREE.Vector3(1,0,0))});for(var n=0;n<lasers.length;n++){var r=lasers[n];r.position.add(r.velocity),(r.position.x<-10||r.position.x>200)&&(scene.remove(r),lasers.splice(n,1))}isMobile&&controls.update()}var socket=io(),scene,width,height,camera,renderer,stereo,clock,textureLoader,controls,orbitControls,container,domElement,hand,laser,lasers,lightsaber,floor,corridor,soundDir,started,Sky=require("../../assets/Sky"),Floor=require("../../assets/Floor"),Corridor=require("../../assets/Corridor"),Hand=require("../../assets/Hand"),Lightsaber=require("../../assets/Lightsaber"),Laser=require("../../assets/Laser"),Utils=require("./utils");$(document).ready(function(){$(".confirm-button").click(function(){init(),animate()})}),socket.emit("viewerjoin",{room:roomId}),socket.on("beginsetup",function(e){}),socket.on("setupcomplete",function(e){$(".confirm-button").show(),socket.emit("viewready")}),socket.on("updateorientation",function(e){hand&&setObjectQuat(hand,e)}),socket.on("updatemotion",function(e){});
